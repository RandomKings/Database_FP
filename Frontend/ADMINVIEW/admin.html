<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col">

    <!-- Header -->
    <header class="bg-blue-600 text-white py-4 shadow">
        <div class="container mx-auto flex justify-between items-center px-4">
            <h1 class="text-2xl font-bold">Admin Dashboard</h1>
            <button class="bg-red-500 hover:bg-red-600 text-white py-2 px-4 rounded">
                Logout
            </button>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto p-4 flex-grow">
        <!-- Hotels Section -->
        <section class="bg-white shadow rounded-lg p-6 mb-6">
            <h2 class="text-xl font-semibold text-gray-700 mb-4">Hotels</h2>
            <table class="w-full border-collapse border border-gray-300">
                <thead>
                    <tr class="bg-gray-200">
                        <th class="border border-gray-300 px-4 py-2 text-left">Hotel ID</th>
                        <th class="border border-gray-300 px-4 py-2 text-left">Hotel Name</th>
                        <th class="border border-gray-300 px-4 py-2 text-left">City</th>
                        <th class="border border-gray-300 px-4 py-2 text-left">Rating</th>
                        <th class="border border-gray-300 px-4 py-2 text-center">Actions</th>
                    </tr>
                </thead>
                <tbody id="hotels-table-body">
                    <!-- Dynamic data will be inserted here -->
                </tbody>
            </table>
        </section>

        <!-- Rooms Section -->
        <section id="rooms-section" class="bg-white shadow rounded-lg p-6 hidden">
            <h2 id="rooms-title" class="text-xl font-semibold text-gray-700 mb-4"></h2>
            <table class="w-full border-collapse border border-gray-300">
                <thead>
                    <tr class="bg-gray-200">
                        <th class="border border-gray-300 px-4 py-2 text-left">Room ID</th>
                        <th class="border border-gray-300 px-4 py-2 text-left">Room Type</th>
                        <th class="border border-gray-300 px-4 py-2 text-left">Status</th>
                        <th class="border border-gray-300 px-4 py-2 text-center">Edit Status</th>
                        <th class="border border-gray-300 px-4 py-2 text-center">Actions</th>
                    </tr>
                </thead>
                <tbody id="rooms-table-body">
                    <!-- Dynamic data will be inserted here -->
                </tbody>
            </table>
        </section>
    </main>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white py-4 text-center">
        <p>&copy; 2024 Hotel Reservation System</p>
    </footer>

    <!-- JavaScript -->
    <script>
        const apiBaseUrl = 'http://localhost:8000';

        // Fetch hotels data
        async function fetchHotels() {
            try {
                const response = await fetch(`${apiBaseUrl}/get_all_hotels/`);
                if (!response.ok) throw new Error('Failed to fetch hotels.');
                
                const hotels = await response.json();
                const hotelsTableBody = document.getElementById('hotels-table-body');
                hotelsTableBody.innerHTML = '';

                hotels.forEach(hotel => {
                    hotelsTableBody.innerHTML += `
                        <tr>
                            <td class="border border-gray-300 px-4 py-2">${hotel.hotelID}</td>
                            <td class="border border-gray-300 px-4 py-2">${hotel.hotel_name}</td>
                            <td class="border border-gray-300 px-4 py-2">${hotel.city}</td>
                            <td class="border border-gray-300 px-4 py-2">${hotel.rating}</td>
                            <td class="border border-gray-300 px-4 py-2 text-center">
                                <button class="bg-blue-500 hover:bg-blue-600 text-white py-1 px-3 rounded" onclick="viewRooms(${hotel.hotelID}, '${hotel.hotel_name}')">View Rooms</button>
                            </td>
                        </tr>
                    `;
                });
            } catch (error) {
                console.error('Error fetching hotels:', error);
            }
        }

        // Fetch rooms for a hotel
        async function viewRooms(hotelID, hotelName) {
            try {
                const response = await fetch(`${apiBaseUrl}/get_rooms/${hotelID}`);
                if (!response.ok) throw new Error('Failed to fetch rooms.');

                const rooms = await response.json();
                const roomsTableBody = document.getElementById('rooms-table-body');
                const roomsTitle = document.getElementById('rooms-title');

                roomsTitle.textContent = `Rooms in ${hotelName}`;
                roomsTableBody.innerHTML = '';

                rooms.forEach(room => {
                    const isDeletable = room.status !== 'Booked' && room.status !== 'Reserved';

                    roomsTableBody.innerHTML += `
                        <tr>
                            <td class="border border-gray-300 px-4 py-2">${room.roomID}</td>
                            <td class="border border-gray-300 px-4 py-2">${room.room_type}</td>
                            <td class="border border-gray-300 px-4 py-2">${room.status}</td>
                            <td class="border border-gray-300 px-4 py-2 text-center">
                                <select class="border rounded px-2 py-1" onchange="updateRoomStatus(${hotelID}, ${room.roomID}, this.value)">
                                    <option value="Available" ${room.status === 'Available' ? 'selected' : ''}>Available</option>
                                    <option value="Booked" ${room.status === 'Booked' ? 'selected' : ''}>Booked</option>
                                    <option value="Under Maintenance" ${room.status === 'Under Maintenance' ? 'selected' : ''}>Under Maintenance</option>
                                    <option value="Reserved" ${room.status === 'Reserved' ? 'selected' : ''}>Reserved</option>
                                </select>
                            </td>
                            <td class="border border-gray-300 px-4 py-2 text-center">
                                <button class="bg-red-500 hover:bg-red-600 text-white py-1 px-3 rounded" ${!isDeletable ? 'disabled' : ''} onclick="deleteRoom(${hotelID}, ${room.roomID}, '${room.status}')">
                                    Delete
                                </button>
                            </td>
                        </tr>
                    `;
                });

                document.getElementById('rooms-section').classList.remove('hidden');
            } catch (error) {
                console.error('Error fetching rooms:', error);
            }
        }

        // Update room status
        async function updateRoomStatus(hotelID, roomID, newStatus) {
            const endpoint = `${apiBaseUrl}/change_room_status/${hotelID}/${roomID}?status=${encodeURIComponent(newStatus)}`;
            try {
                const response = await fetch(endpoint, { method: 'PUT' });
                if (!response.ok) throw new Error('Failed to update room status.');
                alert(`Room ${roomID} status updated to "${newStatus}".`);
            } catch (error) {
                console.error('Error updating room status:', error);
                alert(`Error: ${error.message}`);
            }
        }

        // Delete a room
        async function deleteRoom(hotelID, roomID, status) {
            if (status === 'Booked' || status === 'Reserved') {
                alert(`Cannot delete room ${roomID} because it is "${status}".`);
                return;
            }

            if (!confirm(`Are you sure you want to delete room ${roomID}?`)) return;

            const endpoint = `${apiBaseUrl}/delete_rooms/${hotelID}/${roomID}`;
            try {
                const response = await fetch(endpoint, { method: 'DELETE' });
                if (!response.ok) throw new Error('Failed to delete room.');
                alert(`Room ${roomID} deleted successfully.`);
                viewRooms(hotelID, `Hotel ${hotelID}`); // Refresh the table
            } catch (error) {
                console.error('Error deleting room:', error);
                alert(`Error: ${error.message}`);
            }
        }

        // Load hotels on page load
        document.addEventListener('DOMContentLoaded', fetchHotels);
    </script>
</body>
</html>
